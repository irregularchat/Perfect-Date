<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfect Date Generator - Enhanced UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        .step-indicator {
            transition: all 0.3s ease;
        }
        .step-indicator.active {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
        }
        .timeline-item {
            transition: all 0.3s ease;
        }
        .timeline-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        .editable:hover {
            background-color: rgba(99, 102, 241, 0.05);
            cursor: text;
        }
        .venue-card {
            transition: all 0.3s ease;
        }
        .venue-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">Perfect Date Generator</h1>
                        <p class="text-sm text-gray-600">AI-powered personalized experiences</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="toggleFormMode()" class="px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition">
                        <span id="formModeText">Switch to Wizard</span>
                    </button>
                    <div id="budgetDisplay" class="hidden px-4 py-2 bg-green-100 text-green-700 rounded-lg font-semibold">
                        Budget: $<span id="currentBudget">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Form Wizard -->
        <div id="formWizard" class="hidden bg-white rounded-2xl shadow-xl overflow-hidden mb-8">
            <!-- Progress Bar -->
            <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="stepTitle" class="text-2xl font-bold text-white">What's the Occasion?</h2>
                    <span class="text-white/90">Step <span id="currentStep">1</span> of 5</span>
                </div>
                <div class="flex space-x-2">
                    <div class="step-indicator flex-1 h-2 bg-white rounded-full transition-all" data-step="1"></div>
                    <div class="step-indicator flex-1 h-2 bg-white/30 rounded-full transition-all" data-step="2"></div>
                    <div class="step-indicator flex-1 h-2 bg-white/30 rounded-full transition-all" data-step="3"></div>
                    <div class="step-indicator flex-1 h-2 bg-white/30 rounded-full transition-all" data-step="4"></div>
                    <div class="step-indicator flex-1 h-2 bg-white/30 rounded-full transition-all" data-step="5"></div>
                </div>
            </div>

            <!-- Step Content -->
            <div class="p-8">
                <!-- Step 1: Event Type -->
                <div id="step1" class="step-content">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Event Type</label>
                            <select id="eventType" onchange="dateData.eventType = this.value" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <option value="first_date">First Date</option>
                                <option value="casual_dating" selected>Casual Dating</option>
                                <option value="married_date">Married Date</option>
                                <option value="friends_night">Night with Friends</option>
                                <option value="family_outing">Family Outing</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">When?</label>
                            <div class="grid grid-cols-2 gap-3">
                                <button class="time-option px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-time="today">Today</button>
                                <button class="time-option px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-time="tomorrow">Tomorrow</button>
                                <button class="time-option px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-time="weekend">This Weekend</button>
                                <button class="time-option px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-time="next_week">Next Week</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Time & Budget -->
                <div id="step2" class="step-content hidden">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Time Available: <span id="timeDisplay" class="text-indigo-600 font-bold">4 hours</span>
                            </label>
                            <input type="range" id="timeSlider" min="1" max="12" value="4" class="w-full">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Budget: <span id="budgetSliderDisplay" class="text-green-600 font-bold">$100</span>
                            </label>
                            <input type="range" id="budgetSlider" min="0" max="500" step="10" value="100" class="w-full">
                            <div class="mt-3 flex gap-2">
                                <button onclick="setBudget(0)" class="px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200">Free</button>
                                <button onclick="setBudget(50)" class="px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200">$50</button>
                                <button onclick="setBudget(100)" class="px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200">$100</button>
                                <button onclick="setBudget(200)" class="px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200">$200</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Vibes -->
                <div id="step3" class="step-content hidden">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Select Your Vibes</label>
                            <div class="grid grid-cols-3 gap-3">
                                <button class="vibe-btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-vibe="romantic">üíï Romantic</button>
                                <button class="vibe-btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-vibe="adventurous">üéØ Adventurous</button>
                                <button class="vibe-btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-vibe="relaxed">üòå Relaxed</button>
                                <button class="vibe-btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-vibe="fun">üéâ Fun</button>
                                <button class="vibe-btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-vibe="cultural">üé® Cultural</button>
                                <button class="vibe-btn px-4 py-2 border border-gray-300 rounded-lg hover:bg-indigo-50" data-vibe="sophisticated">üç∑ Sophisticated</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Activity Level: <span id="activityDisplay" class="text-indigo-600 font-bold">5</span>
                            </label>
                            <input type="range" id="activitySlider" min="1" max="10" value="5" class="w-full">
                        </div>
                    </div>
                </div>

                <!-- Step 4: Location -->
                <div id="step4" class="step-content hidden">
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Your Location</label>
                            <div class="flex space-x-2">
                                <input type="text" id="locationInput" placeholder="Enter city or address" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                                <button onclick="getLocation()" class="px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                                    üìç Use My Location
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Preferences</label>
                            <textarea id="preferences" placeholder="What do you like? Any special requests?" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Review -->
                <div id="step5" class="step-content hidden">
                    <div class="p-6 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">Your Perfect Date Summary</h3>
                        <div id="summaryContent" class="space-y-2 text-sm">
                            <!-- Summary will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="flex justify-between mt-8">
                    <button onclick="previousStep()" id="prevBtn" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 disabled:opacity-50" disabled>
                        ‚Üê Previous
                    </button>
                    <button onclick="nextStep()" id="nextBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:shadow-lg">
                        Next ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Classic Form (default visible) -->
        <div id="classicForm" class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold mb-6">Plan Your Perfect Date</h2>
            <form id="dateForm" class="space-y-4">
                <!-- Location with geolocation button -->
                <div class="flex space-x-2">
                    <input type="text" id="quickLocation" placeholder="Location" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <button type="button" onclick="getQuickLocation()" id="quickLocationBtn" class="px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        üìç Use My Location
                    </button>
                </div>
                
                <!-- Budget and other options -->
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="quickBudget" placeholder="Budget ($)" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                    <select id="quickEventType" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                        <option value="casual_dating">Casual Dating</option>
                        <option value="first_date">First Date</option>
                        <option value="married_date">Married Date</option>
                        <option value="friends_night">Night with Friends</option>
                        <option value="family_outing">Family Outing</option>
                    </select>
                </div>
                
                <!-- Quick vibe selection -->
                <div class="flex flex-wrap gap-2">
                    <button type="button" class="quick-vibe px-3 py-1 border border-gray-300 rounded-full hover:bg-indigo-50" data-vibe="romantic">üíï Romantic</button>
                    <button type="button" class="quick-vibe px-3 py-1 border border-gray-300 rounded-full hover:bg-indigo-50" data-vibe="adventurous">üéØ Adventurous</button>
                    <button type="button" class="quick-vibe px-3 py-1 border border-gray-300 rounded-full hover:bg-indigo-50" data-vibe="relaxed">üòå Relaxed</button>
                    <button type="button" class="quick-vibe px-3 py-1 border border-gray-300 rounded-full hover:bg-indigo-50" data-vibe="fun">üéâ Fun</button>
                    <button type="button" class="quick-vibe px-3 py-1 border border-gray-300 rounded-full hover:bg-indigo-50" data-vibe="cultural">üé® Cultural</button>
                </div>
                
                <button type="submit" class="w-full px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg hover:shadow-lg transform transition hover:scale-105">
                    Generate Date Ideas ‚ú®
                </button>
            </form>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden space-y-8">
            <!-- Interactive Map -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h3 class="text-xl font-bold mb-4">Interactive Map</h3>
                <div id="map" class="h-96 rounded-lg"></div>
            </div>

            <!-- Draggable Timeline -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Your Date Timeline</h3>
                    <div class="flex space-x-2">
                        <button onclick="saveDate()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                            üíæ Save
                        </button>
                        <button onclick="shareDate()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            üì§ Share
                        </button>
                        <button onclick="exportCalendar()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            üìÖ Export
                        </button>
                    </div>
                </div>
                <div id="timeline" class="space-y-4">
                    <!-- Timeline items will be added here -->
                </div>
                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <div class="flex justify-between text-sm">
                        <span>Total Duration: <strong id="totalDuration">0 hours</strong></span>
                        <span>Total Cost: <strong id="totalCost">$0</strong></span>
                    </div>
                </div>
            </div>

            <!-- Venue Alternatives -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h3 class="text-xl font-bold mb-4">Alternative Venues</h3>
                <div id="alternatives" class="grid grid-cols-3 gap-4">
                    <!-- Alternative venues will be added here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStepNum = 1;
        let formMode = 'classic';
        let dateData = {
            eventType: 'casual_dating',
            timeAvailable: 4,
            budget: 100,
            vibes: [],
            activityLevel: 5,
            location: '',
            preferences: ''
        };
        let map = null;
        let timeline = [];
        let markers = [];

        // Form mode toggle
        function toggleFormMode() {
            formMode = formMode === 'classic' ? 'wizard' : 'classic';
            document.getElementById('formWizard').classList.toggle('hidden');
            document.getElementById('classicForm').classList.toggle('hidden');
            document.getElementById('formModeText').textContent = formMode === 'classic' ? 'Switch to Wizard' : 'Switch to Classic';
        }

        // Wizard navigation
        function nextStep() {
            if (currentStepNum < 5) {
                document.getElementById(`step${currentStepNum}`).classList.add('hidden');
                currentStepNum++;
                document.getElementById(`step${currentStepNum}`).classList.remove('hidden');
                updateStepUI();
            } else {
                generateDate();
            }
        }

        function previousStep() {
            if (currentStepNum > 1) {
                document.getElementById(`step${currentStepNum}`).classList.add('hidden');
                currentStepNum--;
                document.getElementById(`step${currentStepNum}`).classList.remove('hidden');
                updateStepUI();
            }
        }

        function updateStepUI() {
            // Update progress bars
            document.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                if (index < currentStepNum) {
                    indicator.classList.remove('bg-white/30');
                    indicator.classList.add('bg-white');
                } else {
                    indicator.classList.remove('bg-white');
                    indicator.classList.add('bg-white/30');
                }
            });

            // Update step counter
            document.getElementById('currentStep').textContent = currentStepNum;

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentStepNum === 1;
            document.getElementById('nextBtn').textContent = currentStepNum === 5 ? 'Generate Date ‚ú®' : 'Next ‚Üí';

            // Update title
            const titles = ['What\'s the Occasion?', 'Time & Budget', 'Set the Mood', 'Location & Preferences', 'Review & Generate'];
            document.getElementById('stepTitle').textContent = titles[currentStepNum - 1];

            // Update summary on step 5
            if (currentStepNum === 5) {
                updateSummary();
            }
        }

        function updateSummary() {
            const summary = `
                <div><strong>Event:</strong> ${dateData.eventType.replace('_', ' ')}</div>
                <div><strong>Time:</strong> ${dateData.timeAvailable} hours</div>
                <div><strong>Budget:</strong> $${dateData.budget}</div>
                <div><strong>Vibes:</strong> ${dateData.vibes.join(', ') || 'Not selected'}</div>
                <div><strong>Location:</strong> ${dateData.location || 'Not specified'}</div>
            `;
            document.getElementById('summaryContent').innerHTML = summary;
        }

        // Interactive elements
        document.getElementById('timeSlider')?.addEventListener('input', (e) => {
            dateData.timeAvailable = e.target.value;
            document.getElementById('timeDisplay').textContent = `${e.target.value} hours`;
        });

        document.getElementById('budgetSlider')?.addEventListener('input', (e) => {
            dateData.budget = e.target.value;
            document.getElementById('budgetSliderDisplay').textContent = `$${e.target.value}`;
            document.getElementById('currentBudget').textContent = e.target.value;
        });

        document.getElementById('activitySlider')?.addEventListener('input', (e) => {
            dateData.activityLevel = e.target.value;
            document.getElementById('activityDisplay').textContent = e.target.value;
        });

        function setBudget(amount) {
            dateData.budget = amount;
            document.getElementById('budgetSlider').value = amount;
            document.getElementById('budgetSliderDisplay').textContent = `$${amount}`;
        }

        // Vibe selection
        document.querySelectorAll('.vibe-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('bg-indigo-600');
                btn.classList.toggle('text-white');
                const vibe = btn.dataset.vibe;
                if (dateData.vibes.includes(vibe)) {
                    dateData.vibes = dateData.vibes.filter(v => v !== vibe);
                } else {
                    dateData.vibes.push(vibe);
                }
            });
        });

        // Time option selection
        document.querySelectorAll('.time-option').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.time-option').forEach(b => {
                    b.classList.remove('bg-indigo-600', 'text-white');
                });
                btn.classList.add('bg-indigo-600', 'text-white');
                dateData.timePreference = btn.dataset.time;
            });
        });

        // Geolocation for wizard
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    // Reverse geocode to get address
                    fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
                        .then(r => r.json())
                        .then(data => {
                            const location = data.display_name;
                            document.getElementById('locationInput').value = location;
                            dateData.location = location;
                        });
                });
            }
        }

        // Geolocation for classic form
        function getQuickLocation() {
            const btn = document.getElementById('quickLocationBtn');
            btn.innerHTML = '‚è≥ Getting location...';
            btn.disabled = true;
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        // Reverse geocode to get address
                        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
                            .then(r => r.json())
                            .then(data => {
                                const location = data.display_name || `${lat}, ${lon}`;
                                document.getElementById('quickLocation').value = location;
                                btn.innerHTML = 'üìç Use My Location';
                                btn.disabled = false;
                            })
                            .catch(() => {
                                btn.innerHTML = 'üìç Use My Location';
                                btn.disabled = false;
                                alert('Could not get address from coordinates');
                            });
                    },
                    (error) => {
                        btn.innerHTML = 'üìç Use My Location';
                        btn.disabled = false;
                        alert('Location access denied. Please enter manually.');
                    }
                );
            } else {
                btn.innerHTML = 'üìç Use My Location';
                btn.disabled = false;
                alert('Geolocation is not supported by your browser');
            }
        }

        // Generate date with dynamic content based on input
        function generateDate() {
            // Collect data from wizard
            if (document.getElementById('locationInput')) {
                dateData.location = document.getElementById('locationInput').value;
            }
            if (document.getElementById('preferences')) {
                dateData.preferences = document.getElementById('preferences').value;
            }
            
            // Collect data from classic form
            if (formMode === 'classic') {
                dateData.location = document.getElementById('quickLocation').value || 'Virginia Beach';
                dateData.budget = parseInt(document.getElementById('quickBudget').value) || 100;
            }

            // Show loading state
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="text-center py-12">
                    <div class="inline-flex items-center justify-center">
                        <div class="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
                    </div>
                    <p class="mt-4 text-gray-600">Generating your perfect date ideas...</p>
                </div>
            `;
            resultsDiv.classList.remove('hidden');
            
            // Simulate API call delay
            setTimeout(() => {
                // Restore results structure
                resultsDiv.innerHTML = `
                    <!-- Interactive Map -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Interactive Map</h3>
                        <div id="map" class="h-96 rounded-lg"></div>
                    </div>

                    <!-- Draggable Timeline -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold">Your Date Timeline</h3>
                            <div class="flex space-x-2">
                                <button onclick="saveDate()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    üíæ Save
                                </button>
                                <button onclick="shareDate()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                    üì§ Share
                                </button>
                                <button onclick="exportCalendar()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                                    üìÖ Export
                                </button>
                            </div>
                        </div>
                        <div id="timeline" class="space-y-4">
                            <!-- Timeline items will be added here -->
                        </div>
                        <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                            <div class="flex justify-between text-sm">
                                <span>Total Duration: <strong id="totalDuration">0 hours</strong></span>
                                <span>Total Cost: <strong id="totalCost">$0</strong></span>
                            </div>
                        </div>
                    </div>

                    <!-- Venue Alternatives -->
                    <div class="bg-white rounded-2xl shadow-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Alternative Venues</h3>
                        <div id="alternatives" class="grid grid-cols-3 gap-4">
                            <!-- Alternative venues will be added here -->
                        </div>
                    </div>
                `;
                
                // Show results
                document.getElementById('budgetDisplay').classList.remove('hidden');
                
                // Initialize map
                initMap();
                
                // Create dynamic timeline based on input
                createDynamicTimeline();
                
                // Scroll to results
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            }, 1500);
        }

        // Create dynamic timeline based on user input
        function createDynamicTimeline() {
            const eventType = dateData.eventType || 'casual_dating';
            const budget = dateData.budget || 100;
            const hours = dateData.timeAvailable || 4;
            const vibes = dateData.vibes || [];
            
            // Get user's coordinates or use default
            let baseLat = 35.7796; // Default Raleigh, NC
            let baseLng = -78.6382;
            
            // Try to get actual user location from map center
            if (map) {
                const center = map.getCenter();
                baseLat = center.lat;
                baseLng = center.lng;
            }
            
            // Different activity sets based on event type and vibes
            const activitySets = {
                'first_date': [
                    { time: '6:00 PM', activity: 'Coffee at Cozy Cafe', cost: 15, location: [baseLat, baseLng] },
                    { time: '7:00 PM', activity: 'Mini Golf & Ice Cream', cost: 25, location: [baseLat + 0.002, baseLng + 0.002] },
                    { time: '8:30 PM', activity: 'Sunset Walk', cost: 0, location: [baseLat + 0.004, baseLng + 0.004] }
                ],
                'casual_dating': [
                    { time: '2:00 PM', activity: 'Lunch at Local Bistro', cost: 40, location: [baseLat, baseLng] },
                    { time: '3:30 PM', activity: 'Arcade & Games', cost: 20, location: [baseLat + 0.003, baseLng + 0.003] },
                    { time: '5:00 PM', activity: 'Happy Hour Drinks', cost: 30, location: [baseLat + 0.005, baseLng + 0.005] },
                    { time: '6:30 PM', activity: 'Live Music Venue', cost: 25, location: [baseLat + 0.007, baseLng + 0.007] }
                ],
                'married_date': [
                    { time: '5:00 PM', activity: 'Couples Spa Treatment', cost: 150, location: [baseLat, baseLng] },
                    { time: '7:00 PM', activity: 'Fine Dining Experience', cost: 120, location: [baseLat + 0.004, baseLng + 0.004] },
                    { time: '9:00 PM', activity: 'Rooftop Bar & Dancing', cost: 40, location: [baseLat + 0.006, baseLng + 0.006] }
                ],
                'friends_night': [
                    { time: '6:00 PM', activity: 'Bowling & Appetizers', cost: 35, location: [baseLat, baseLng] },
                    { time: '8:00 PM', activity: 'Trivia Night at Pub', cost: 25, location: [baseLat + 0.003, baseLng + 0.003] },
                    { time: '10:00 PM', activity: 'Karaoke Bar', cost: 20, location: [baseLat + 0.005, baseLng + 0.005] }
                ],
                'family_outing': [
                    { time: '11:00 AM', activity: 'Science Museum', cost: 60, location: [baseLat, baseLng] },
                    { time: '1:00 PM', activity: 'Family Restaurant', cost: 80, location: [baseLat + 0.002, baseLng + 0.002] },
                    { time: '3:00 PM', activity: 'Park & Playground', cost: 0, location: [baseLat + 0.004, baseLng + 0.004] },
                    { time: '5:00 PM', activity: 'Ice Cream Shop', cost: 20, location: [baseLat + 0.006, baseLng + 0.006] }
                ]
            };

            // Adjust activities based on vibes
            let activities = activitySets[eventType] || activitySets['casual_dating'];
            
            // Modify based on selected vibes
            if (vibes.includes('romantic')) {
                activities[0].activity = 'üåπ ' + activities[0].activity;
            }
            if (vibes.includes('adventurous')) {
                activities.push({ 
                    time: '9:00 PM', 
                    activity: 'üéØ Escape Room Challenge', 
                    cost: 35, 
                    location: [baseLat + 0.008, baseLng + 0.008] 
                });
            }
            if (vibes.includes('cultural')) {
                activities[1] = { 
                    time: activities[1].time, 
                    activity: 'üé® Art Gallery Tour', 
                    cost: 15, 
                    location: activities[1].location 
                };
            }
            
            // Adjust to budget
            if (budget < 50) {
                activities = activities.map(a => ({
                    ...a,
                    activity: a.activity.includes('Fine Dining') ? 'Casual Dining' : a.activity,
                    cost: Math.min(a.cost, 15)
                }));
            }
            
            // Adjust to time available
            activities = activities.slice(0, Math.min(activities.length, Math.ceil(hours / 1.5)));
            
            timeline = activities;
            renderTimeline();
            addMarkersToMap();
        }

        // Initialize interactive map with user's location
        function initMap() {
            if (!map) {
                // Try to get user's actual location
                if (navigator.geolocation && !map) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const userLat = position.coords.latitude;
                            const userLng = position.coords.longitude;
                            map = L.map('map').setView([userLat, userLng], 13);
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '¬© OpenStreetMap contributors'
                            }).addTo(map);
                            
                            // Add marker for user location
                            L.marker([userLat, userLng])
                                .addTo(map)
                                .bindPopup('üìç Your Location')
                                .openPopup();
                        },
                        (error) => {
                            // Fallback to default location
                            console.log('Geolocation failed, using default');
                            map = L.map('map').setView([35.7796, -78.6382], 13); // Default to Raleigh, NC
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '¬© OpenStreetMap contributors'
                            }).addTo(map);
                        }
                    );
                } else {
                    // Fallback if geolocation not available
                    map = L.map('map').setView([35.7796, -78.6382], 13); // Default to Raleigh, NC
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(map);
                }
            }
        }


        function renderTimeline() {
            const timelineEl = document.getElementById('timeline');
            timelineEl.innerHTML = '';
            
            timeline.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'timeline-item bg-gradient-to-r from-indigo-50 to-purple-50 p-4 rounded-lg cursor-move';
                div.dataset.index = index;
                div.innerHTML = `
                    <div class="space-y-3">
                        <div class="flex justify-between items-start">
                            <div class="flex items-start space-x-3 flex-1">
                                <span class="text-2xl">üìç</span>
                                <div class="flex-1">
                                    <div class="font-semibold text-lg editable" contenteditable="true" data-field="activity">${item.activity}</div>
                                    <div class="text-sm text-gray-600 mt-1">
                                        <span class="editable" contenteditable="true" data-field="time">${item.time}</span> ‚Ä¢ 
                                        $<span class="editable" contenteditable="true" data-field="cost">${item.cost}</span>
                                    </div>
                                    
                                    <!-- Business Information -->
                                    <div class="mt-3 p-3 bg-gray-50 rounded-lg" id="business-info-${index}">
                                        <div class="text-sm space-y-1">
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium text-gray-700">üìç Address:</span>
                                                <span class="text-gray-600">${generateMockAddress(item.location)}</span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium text-gray-700">‚≠ê Rating:</span>
                                                <span class="text-yellow-600">${generateMockRating()} (${Math.floor(Math.random() * 200 + 50)} reviews)</span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium text-gray-700">üïí Hours:</span>
                                                <span class="text-green-600">${generateMockHours()}</span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium text-gray-700">üìû Phone:</span>
                                                <span class="text-blue-600">${generateMockPhone()}</span>
                                            </div>
                                            <div class="flex space-x-3 mt-2">
                                                <a href="#" onclick="openDirections(${item.location[0]}, ${item.location[1]})" class="text-blue-600 hover:underline text-xs">üó∫Ô∏è Directions</a>
                                                <a href="#" onclick="callBusiness('${generateMockPhone()}')" class="text-green-600 hover:underline text-xs">üìû Call</a>
                                                <a href="#" onclick="viewWebsite('${item.activity}')" class="text-purple-600 hover:underline text-xs">üåê Website</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2 ml-4">
                                <button onclick="swapVenue(${index})" class="px-3 py-1 bg-white text-indigo-600 rounded hover:bg-indigo-50 text-sm">
                                    üîÑ Swap
                                </button>
                                <button onclick="removeActivity(${index})" class="px-3 py-1 bg-white text-red-600 rounded hover:bg-red-50 text-sm">
                                    ‚úï
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                timelineEl.appendChild(div);
            });

            // Make timeline sortable
            new Sortable(timelineEl, {
                animation: 150,
                ghostClass: 'dragging',
                onEnd: function(evt) {
                    // Reorder timeline array
                    const item = timeline.splice(evt.oldIndex, 1)[0];
                    timeline.splice(evt.newIndex, 0, item);
                    updateTotals();
                }
            });

            // Add inline editing
            document.querySelectorAll('.editable').forEach(el => {
                el.addEventListener('blur', function() {
                    const index = this.closest('.timeline-item').dataset.index;
                    const field = this.dataset.field;
                    const value = field === 'cost' ? parseFloat(this.textContent) : this.textContent;
                    timeline[index][field] = value;
                    updateTotals();
                });
            });

            updateTotals();
        }

        function updateTotals() {
            const totalCost = timeline.reduce((sum, item) => sum + (item.cost || 0), 0);
            const totalHours = timeline.length * 1.5; // Estimate 1.5 hours per activity
            
            document.getElementById('totalCost').textContent = `$${totalCost}`;
            document.getElementById('totalDuration').textContent = `${totalHours} hours`;
            document.getElementById('currentBudget').textContent = totalCost;
        }

        function addMarkersToMap() {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];

            // Add new markers
            timeline.forEach((item, index) => {
                const marker = L.marker(item.location)
                    .addTo(map)
                    .bindPopup(`
                        <div class="p-2">
                            <strong>${item.activity}</strong><br>
                            ${item.time} ‚Ä¢ $${item.cost}
                        </div>
                    `);
                markers.push(marker);
            });

            // Draw route between markers
            if (markers.length > 1) {
                const latlngs = timeline.map(item => item.location);
                L.polyline(latlngs, { color: 'indigo', weight: 3, opacity: 0.7 }).addTo(map);
            }

            // Fit map to markers
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        function swapVenue(index) {
            const currentActivity = timeline[index];
            
            // Generate alternative venues with full business details
            const alternatives = generateAlternativeVenues(currentActivity.activity);
            
            const altHtml = alternatives.map((alt, altIndex) => `
                <div class="venue-card p-4 bg-white rounded-lg shadow cursor-pointer hover:shadow-lg transition-all border" onclick="replaceVenue(${index}, ${altIndex})">
                    <div class="space-y-2">
                        <div class="font-semibold text-lg">${alt.name}</div>
                        <div class="flex items-center space-x-3 text-sm">
                            <span class="text-yellow-600">‚≠ê ${alt.rating}</span>
                            <span class="text-gray-600">${alt.priceLevel}</span>
                            <span class="text-blue-600">${alt.distance}</span>
                        </div>
                        <div class="text-sm text-gray-600">${alt.address}</div>
                        <div class="text-sm">
                            <span class="font-medium">üìû</span> ${alt.phone}
                        </div>
                        <div class="text-xs text-green-600">${alt.hours}</div>
                        <div class="text-sm text-gray-700">${alt.description}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('alternatives').innerHTML = `
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-900">Alternative venues for "${currentActivity.activity}":</h4>
                    <p class="text-sm text-gray-600">Click on any venue to replace it in your timeline</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${altHtml}
                </div>
            `;
            document.getElementById('alternatives').scrollIntoView({ behavior: 'smooth' });
        }

        function generateAlternativeVenues(currentActivity) {
            // Generate different alternatives based on activity type
            const venueTypes = {
                'coffee': ['Blue Moon Cafe', 'Roasted Bean Coffee', 'The Daily Grind', 'Corner Coffee Shop'],
                'restaurant': ['Bella Vista Italian', 'The Steakhouse', 'Garden Bistro', 'Local Farm Table'],
                'bar': ['The Tap Room', 'Vintage Wine Bar', 'Craft Beer Hall', 'Cocktail Lounge'],
                'entertainment': ['Zone Entertainment', 'GameTime Arcade', 'Strike Zone Bowling', 'Fun Factory'],
                'default': ['Popular Local Spot', 'Trending Venue', 'Customer Favorite', 'Hidden Gem']
            };

            let categoryOptions = venueTypes.default;
            if (currentActivity.toLowerCase().includes('coffee') || currentActivity.toLowerCase().includes('cafe')) {
                categoryOptions = venueTypes.coffee;
            } else if (currentActivity.toLowerCase().includes('lunch') || currentActivity.toLowerCase().includes('dinner') || currentActivity.toLowerCase().includes('bistro')) {
                categoryOptions = venueTypes.restaurant;
            } else if (currentActivity.toLowerCase().includes('drinks') || currentActivity.toLowerCase().includes('bar')) {
                categoryOptions = venueTypes.bar;
            } else if (currentActivity.toLowerCase().includes('arcade') || currentActivity.toLowerCase().includes('games') || currentActivity.toLowerCase().includes('bowling')) {
                categoryOptions = venueTypes.entertainment;
            }

            return categoryOptions.map(name => ({
                name: name,
                rating: generateMockRating(),
                priceLevel: ['$', '$$', '$$$'][Math.floor(Math.random() * 3)],
                distance: `${(Math.random() * 2 + 0.1).toFixed(1)} mi`,
                address: generateMockAddress(),
                phone: generateMockPhone(),
                hours: generateMockHours(),
                description: generateVenueDescription(name)
            }));
        }

        function generateVenueDescription(name) {
            const descriptions = [
                'Highly rated local favorite with great atmosphere',
                'Known for excellent service and quality',
                'Popular spot with locals and visitors alike',
                'Cozy setting perfect for a great time',
                'Award-winning establishment with unique charm',
                'Modern venue with classic touches'
            ];
            return descriptions[Math.floor(Math.random() * descriptions.length)];
        }

        function replaceVenue(timelineIndex, venueIndex) {
            const alternatives = generateAlternativeVenues(timeline[timelineIndex].activity);
            const newVenue = alternatives[venueIndex];
            
            // Update timeline with new venue
            timeline[timelineIndex].activity = newVenue.name;
            
            // Clear alternatives section
            document.getElementById('alternatives').innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <p>‚úÖ Venue updated! Click "üîÑ Swap" on any activity to see more alternatives.</p>
                </div>
            `;
            
            renderTimeline();
            addMarkersToMap();
        }

        function removeActivity(index) {
            timeline.splice(index, 1);
            renderTimeline();
            addMarkersToMap();
        }

        function saveDate() {
            const dateStr = JSON.stringify({ timeline, dateData });
            localStorage.setItem('savedDate', dateStr);
            alert('Date saved successfully! üíæ');
        }

        function shareDate() {
            const shareUrl = `${window.location.origin}?date=${btoa(JSON.stringify(timeline))}`;
            navigator.clipboard.writeText(shareUrl);
            alert('Share link copied to clipboard! üìã');
        }

        function exportCalendar() {
            // Create iCal format
            let ical = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Perfect Date//EN\n';
            timeline.forEach(item => {
                ical += `BEGIN:VEVENT\nSUMMARY:${item.activity}\nDTSTART:${new Date().toISOString()}\nEND:VEVENT\n`;
            });
            ical += 'END:VCALENDAR';
            
            // Download file
            const blob = new Blob([ical], { type: 'text/calendar' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'perfect-date.ics';
            a.click();
        }

        // Generate realistic business information
        function generateMockAddress(location) {
            const streetNumbers = [123, 456, 789, 1234, 567];
            const streetNames = ['Main St', 'Oak Ave', 'Elm Dr', 'Pine Rd', 'Cedar Way', 'Market St', 'University Dr'];
            const number = streetNumbers[Math.floor(Math.random() * streetNumbers.length)];
            const street = streetNames[Math.floor(Math.random() * streetNames.length)];
            return `${number} ${street}, Fayetteville, NC`;
        }

        function generateMockRating() {
            const ratings = ['4.2', '4.5', '4.1', '4.7', '4.3', '4.6', '4.4'];
            return ratings[Math.floor(Math.random() * ratings.length)];
        }

        function generateMockHours() {
            const currentHour = new Date().getHours();
            if (currentHour >= 9 && currentHour < 22) {
                return 'Open now ‚Ä¢ Closes 10:00 PM';
            } else if (currentHour >= 22 || currentHour < 6) {
                return 'Closed ‚Ä¢ Opens 9:00 AM';
            } else {
                return 'Opens soon ‚Ä¢ 9:00 AM';
            }
        }

        function generateMockPhone() {
            return `(910) ${Math.floor(Math.random() * 900 + 100)}-${Math.floor(Math.random() * 9000 + 1000)}`;
        }

        // Business interaction functions
        function openDirections(lat, lng) {
            const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
            window.open(url, '_blank');
        }

        function callBusiness(phone) {
            window.location.href = `tel:${phone}`;
        }

        function viewWebsite(businessName) {
            // Generate a mock website or search
            const searchQuery = encodeURIComponent(businessName + ' Fayetteville NC');
            const url = `https://www.google.com/search?q=${searchQuery}`;
            window.open(url, '_blank');
        }

        // Quick vibe selection for classic form
        document.querySelectorAll('.quick-vibe').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('bg-indigo-600');
                btn.classList.toggle('text-white');
                btn.classList.toggle('border-gray-300');
                const vibe = btn.dataset.vibe;
                if (!dateData.vibes) dateData.vibes = [];
                if (dateData.vibes.includes(vibe)) {
                    dateData.vibes = dateData.vibes.filter(v => v !== vibe);
                } else {
                    dateData.vibes.push(vibe);
                }
            });
        });

        // Classic form submission
        document.getElementById('dateForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Collect all form data
            dateData.location = document.getElementById('quickLocation').value || 'Virginia Beach';
            dateData.budget = parseInt(document.getElementById('quickBudget').value) || 100;
            dateData.eventType = document.getElementById('quickEventType').value;
            
            // Vibes are already collected via click handlers
            
            generateDate();
        });
    </script>
</body>
</html>